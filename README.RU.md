###########################################################################################
#
#               stm32f103 - пример проекта для STM32F103 (Black Pill board)
#
###########################################################################################


## Состав рабочего оборудования:

```
* stm32f103C8t6 (Black Pill board) - плата микроконтроллера
* ssd1306 - OLED дисплей 0.96" 128x64 (интерфейс I2C)
* bmp280 - датчик атмосферного давления и температуры воздуха (интерфейс I2C).
* bh1750 - датчик освещенности (интерфейс I2C).
* ws2812 - линейка из восьми RGB светодиодов.
```


# Средства разработки:

```
* STM32CubeMX - графический пакет для создание проектов (на языке Си) под микроконтроллеры семейства STM32
  (https://www.st.com/en/development-tools/stm32cubemx.html).
* System Workbench for STM32 - IDE среда разработки ПО для микроконтроллеров семейства STM32
  (https://www.st.com/en/development-tools/sw4stm32.html).
* StLink Tools - утилиты для отладки и записи во flash-ROM готовых бинарников с помощью отладчика St-Link/v2
  (сырцы тут -  https://github.com/texane/stlink).
* stm32flash - утилита для программирования (прошивки) flash-ROM микроконтроллеров семейства STM32
  через встроенный порт UART1 (сырцы тут - https://sourceforge.net/projects/stm32flash/files/)
```


# Функционал:

```
* Устройство использует программные средства freeRTOS :
  - PwmTask - нитка (задача), обслуживания светодиодов ws2812.
  - BmpTask - нитка (задача), работающая с датчиком bmp280.
  - DefTask - нитка (задача), выполняющая функцию main.
  - mailQueue - очередь для передачи данных от bmp280 из задачи dmpTask в задачу DefTask,
    для вывода данных на дисплей ssd1306 и для вывода в последовательный порт (UART1).
  - semUart - бинарный семафор на доступ к порту uart1 (по записи).
* Устройство инициализирует некоторые интерфейсы микроконтроллера :
  - GPIO : подключены два сетодиода : LED1(pin PB0) - секундная индикация таймера, LED2(pin PB12) - индикация ошибки.
  - RTC : модуль инициализирован датой 01.01.1900 00:00:00.
  - I2C1 : режим мастера с частотой 400Кгц (шина ослуживает ssd1306, bmp280, bh1750).
  - UART1 : параметры порта 500000 8N1 - порт для логов и установки даты и времени, если подключен комп.
  - DMA1.4 : используется канал № 4 для пересылки данных в UART1.
  - DMA1.7 : используется канал № 7 для пересылки данных PWM в WS2812 (pin PA1).
  - TIM1 : таймер-счетчик временных интервалов в 0.5 и 1 секунду, реализован в callback-функции.
  - TIM2 : таймер, используется для формирования данных PWM для WS28112.
  - ADC1 : измеряет напряжение питания (pin PA5)
* Системный таймер (TIM4) считает миллисекунды от начала работы устройства.
* Каждые 10 секунд считываются данные с датчиков bmp280 и bh1750, выполняется пересчет атмосферного
  давления в мм ртутного столба и температуры в градусы Цельсия, полученные данные выдаются
  в UART1, например :
000.00:00:02 | Vcc=3.252 v; BMP280: Press=766.43 mmHg, Temp=27.62 DegC; BH1750: Lux=55.83 lx
000.00:00:12 | Vcc=3.216 v; BMP280: Press=766.49 mmHg, Temp=27.61 DegC; BH1750: Lux=38.33 lx
000.00:00:02 | Vcc=3.241 v; BMP280: Press=766.51 mmHg, Temp=27.74 DegC; BH1750: Lux=48.33 lx
или так :
2019.04.23 10:49:00 | Vcc=3.222 v; BMP280: Press=766.39 mmHg, Temp=27.62 DegC; BH1750: Lux=125.00 lx
2019.04.23 10:49:10 | Vcc=3.086 v; BMP280: Press=766.31 mmHg, Temp=27.62 DegC; BH1750: Lux=457.50 lx
2019.04.23 10:49:20 | Vcc=3.183 v; BMP280: Press=766.35 mmHg, Temp=27.67 DegC; BH1750: Lux=12.50 lx
  Эти же данные (время работы, напряжение питания, атмосферное давление, температура воздуха и освещенность)
отображаются на дисплей ssd1306.
* Через uart1 можно установить текущее время в RTC, отправив команду :
date=1554977111 , где 1554977111 - GMT epoch time
```
